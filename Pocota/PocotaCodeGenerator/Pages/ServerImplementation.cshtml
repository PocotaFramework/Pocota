@page
@using Net.Leksi.Pocota.Common
@model ClassModel
@Html.Partial("HeaderComment", Model)

@foreach (string usng in Model.Usings.OrderBy(v => v))
{
    <text>using @usng;
    </text>
}

namespace @Model.NamespaceValue;

public @if (Model.IsAbstract)
{
    <text>abstract </text>
}
class @Model.ClassName: @Html.Raw(string.Join(", ", Model.Interfaces))
{

    @Html.Raw("#region Projection classes");

    @foreach (ClassModel model in Model.Classes)
    {
        @Html.Partial("Projection", model)
    }
    @Html.Raw("#endregion Projection classes");

    @Html.Partial("InitProperties", Model)

    @Html.Partial("ProjectionsProperties", Model)
    
    @if(Model.Source is {})
    {
        <text>    @Html.Raw(Model.Source)
</text>
    }
    else
    {
        <text>    @Html.Raw($"public {Model.ClassName} Source {{ get => this; }}")
</text>
    }

    @Html.Partial("Properties", Model)

    public @Html.Raw($"{Model.ClassName}(IServiceProvider services) : base(services)") 
    { 
        @if (Model.IsEntity)
        {
            <text>        SetPrimaryKey(new @Html.Raw($"{Model.PrimaryKeyName}(this)"));
</text>
        }
    }

    @Html.Partial("Methods", Model)

    @Html.Partial("PropertiesAccessors", Model)
}